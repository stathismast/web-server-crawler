Ευστάθιος-Ανδρέας Μαστοράκης - sdi1500092

Τρίτη Εργασία Προγραμματισμός Συστήματος

ΠΡΟΣΟΧΗ: Η search της δεύτερης εργασίας είναι προβληματική. Με μεγάλα αρχεία,
         όπως τα pages που έχουν >1000 σειρές, σχεδόν πάντα αποτυγχάνει. Οπότε,
         όταν δίνεται στο command port κάποιο SEARCH είναι πολύ πιθανό οι
         workers του jobExecutor να αποτύχουν και να τερματίσουν. Αν αποτύχουν,
         εμφανίζεται από τον jobExecutor ανάλογο μήνυμα στο command port ενώ αν
         επιτύχει εμφανίζονται τα αποτελέσματα στο command port.

Σημείωση: Αν η search επιτύχει τότε θα αγνοήσει τα html tags.

SERVER:
    Ο σέρβερ δημιουργεί ένα thread pool και μία ουρά (δυναμική δομή, χωρίς άνω
όριο) στην οποία θα βάζει τα file descriptor των socket για κάθε request.
    Χρησιμοποιεί την poll για να περιμένει για σύνδεση είτε στο command port
είτε στο serving port.
    Το κάθε thread του server προσπαθεί να λάβει το πρώτο στοιχείο στην ουρά.
Αν αυτή είναι άδεια θα περιμένει (με condition variable).
Όταν ο server αποδεκτεί σύνδεση στο serving port θα προσθέσει το fd στην ουρά
και θα ειδοποιήσει το πρώτο thread να ελέγξει την ουρά για το fd. Όλη αυτή η
λειτουργικότητα προστατεύεται από mutex και condition variable.

CRAWLER:
    O crawler έχει επίσης μία ουρά (δυναμική δομή, χωρίς άνω όριο) και ένα
thread pool. Αρχικά προσθέτει το starting URL στην ουρά, έπειτα δημιουργεί τα
threads.
    Το κάθε thread προσπαθεί (με χρήση mutex) να λάβει κάποιο όνομα αρχείου από
την ουρά και αν η ουρά είναι άδεια περιμένει το αντιστοιχο condition variable.
Αν ένα thread λάβει κάποιο όνομα, ξεκλειδώνει το mutex του και ζητά το αρχείο
από τον server, αναζητά links μέσα σε αυτό. Αφού βρεί όλα τα links μέσα στο
αρχείο θα ξανακλειδώσει το mutex έτσι ώστε να προσθέσει τα links που βρήκε στην
ουρά και ειδοποιεί τα υπόλοιπα threads ότι υπάρχουν νέα όνοματα αρχείων που
θέλουμε να ζητήσουμε από τον server.
    To crawling σταματα πρακτικά όταν όλα τα threads είναι στην κατάσταση που
περιμένουν την condition variable. Όταν συμβεί αυτό, ειδοποιείται το βασικό
thread, θέτει την τιμή της μεταβλητής 'done' σε αληθή και ειδοποιέι τα threads
ώστε να κάνουν join.
    Μετά το crawling καλείται μία συνάρτηση της δεύτερης εργασία που προετοιμά-
ζει τον jobExecutor και τους workers για να εκτελέσουν αναζητήσεις στα αρχεία.
    Κατά τη διάρκεια του crawling γίνεται poll στο command port για πιθανά
commands, ομοίως και μετά την ολοκλήρωση του crawling.
